<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>베이크 알바 도우미</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
</head>
<body>
    <div class="main">
        <div class="container-sm m-10">
            <h1 class="m-4">📜 BAKE 당일생산 계산기</h1>
            <h3 class="m-3">✔ 전일 잔량</h3>
            <form class="bake-form m-3">
                <div class="m-3">
                    <label class="form-label">치즈</label>
                    <input type="number" class="form-control" id="cheese-yesterday" placeholder="전일 잔량을 입력하세요." >
                </div>
                <div class="m-3">
                    <label class="form-label">시즌 1</label>
                    <input type="number" class="form-control" id="season1-yesterday" placeholder="전일 잔량을 입력하세요.">
                </div>
                <div class="m-3">
                    <label class="form-label">시즌 2</label>
                    <input type="number" class="form-control" id="season2-yesterday" placeholder="전일 잔량을 입력하세요.">
                </div>
            </form>
            <h3 class="m-3">✔ 입고</h3>
            <form class="bake-form m-3">
                <div class="m-3">
                    <label class="form-label">치즈</label>
                    <input type="number" class="form-control" id="cheese-receiving-box" placeholder="박스 개수를 입력하세요.">
                </div>
                <div class="m-3">
                    <label class="form-label">시즌 1</label>
                    <input type="number" class="form-control" id="season1-receiving-box" placeholder="박스 개수를 입력하세요.">
                </div>
                <div class="m-3">
                    <label class="form-label">시즌 2</label>
                    <input type="number" class="form-control" id="season2-receiving-box" placeholder="박스 개수를 입력하세요.">
                </div>
            </form>
            <h3 class="m-3">✔ 남은 재고</h3>
            <form class="bake-form m-3">
                <div class="m-3">
                    <label class="form-label">치즈</label>
                    <input type="number" class="form-control" id="cheese-left-box" placeholder="박스 개수를 입력하세요.">
                    <input type="number" class="form-control" id="cheese-left-pan" placeholder="판 개수를 입력하세요.">
                    <input type="number" class="form-control" id="cheese-left-piece" placeholder="낱개 개수를 입력하세요.">
                </div>
                <div class="m-3">
                    <label class="form-label">시즌 1</label>
                    <input type="number" class="form-control" id="season1-left-box" placeholder="박스 개수를 입력하세요.">
                    <input type="number" class="form-control" id="season1-left-pan" placeholder="판 개수를 입력하세요.">
                    <input type="number" class="form-control" id="season1-left-piece" placeholder="낱개 개수를 입력하세요.">
                </div>
                <div class="m-3">
                    <label class="form-label">시즌 2</label>
                    <input type="number" class="form-control" id="season2-left-box" placeholder="박스 개수를 입력하세요.">
                    <input type="number" class="form-control" id="season2-left-pan" placeholder="판 개수를 입력하세요.">
                    <input type="number" class="form-control" id="season2-left-piece" placeholder="낱개 개수를 입력하세요.">
                </div>
                <button type="button" class="btn btn-primary m-3" id="calculate-btn" >계산하기</button>
                <button type="reset" class="btn btn-secondary m-3" id="reset-btn" >초기화</button>
            </form>

            <div class="m-3">
                <div class="card border-primary mb-3" style="width: 18rem;">
                    <div class="card-header">입고</div>
                    <div class="card-body text-primary" id="receiving-result">
                        <p class="card-text">치즈 : <input type="text" class="cheese" disabled/></p>
                        <p class="card-text">시즌1 : <input type="text" class="season1" disabled/></p>
                        <p class="card-text">시즌2 : <input type="text" class="season2" disabled/></p>
                    </div>
                </div>
                <div class="card border-secondary mb-3" style="width: 18rem;">
                    <div class="card-header">당일생산</div>
                    <div class="card-body text-primary" id="today-sell">
                        <p class="card-text">치즈 : <input type="text" class="cheese" disabled/></p>
                        <p class="card-text">시즌1 : <input type="text" class="season1" disabled/></p>
                        <p class="card-text">시즌2 : <input type="text" class="season2" disabled/></p>
                    </div>
                </div>
                <div class="card border-success mb-3" style="width: 18rem;">
                    <div class="card-header">남은재고</div>
                    <div class="card-body text-primary" id="left-result">
                        <p class="card-text">치즈 : <input type="text" class="cheese" disabled/></p>
                        <p class="card-text">시즌1 : <input type="text" class="season1" disabled/></p>
                        <p class="card-text">시즌2 : <input type="text" class="season2" disabled/></p>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.1/cjs/popper.min.js"
            integrity="sha256-T3bYsIPyOLpEfeZOX4M7J59ZoDMzuYFUsPiSN3Xcc2M=" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"></script>

    <script>
        document.getElementById("reset-btn").addEventListener("click", function(event) {
            event.preventDefault();
            document.querySelectorAll(".bake-form").forEach(form => form.reset());
            document.querySelectorAll("input").forEach(input => input.setAttribute("value", ""));
        }, false);

        document.getElementById("calculate-btn").addEventListener("click", function(event) {
            event.preventDefault();
            handleClick();
        }, false);

        let handleClick = () => {
            let cheese = calculate(false, 0);
            let season1 = calculate(true, 1);
            let season2 = calculate(true,2);

            document.querySelector("#receiving-result .cheese").setAttribute("value", cheese.receiving);
            document.querySelector("#today-sell .cheese").setAttribute("value", cheese.todaySell);
            document.querySelector("#left-result .cheese").setAttribute("value", cheese.left);

            document.querySelector("#receiving-result .season1").setAttribute("value", season1.receiving);
            document.querySelector("#today-sell .season1").setAttribute("value", season1.todaySell);
            document.querySelector("#left-result .season1").setAttribute("value", season1.left);

            document.querySelector("#receiving-result .season2").setAttribute("value", season2.receiving);
            document.querySelector("#today-sell .season2").setAttribute("value", season2.todaySell);
            document.querySelector("#left-result .season2").setAttribute("value", season2.left);

        }

        let calculate = (season, i) => {
            let menu = "";
            if(season){
                menu = "season" + i;
            } else {
                menu = "cheese"
            }
            let yesterday = sanitize(document.getElementById(menu + "-yesterday").value);
            let receiving = sanitize(document.getElementById(menu + "-receiving-box").value);
            let leftBox = sanitize(document.getElementById(menu + "-left-box").value);
            let leftPan = sanitize(document.getElementById(menu + "-left-pan").value);
            let leftPiece = sanitize(document.getElementById(menu + "-left-piece").value);


            if(season){
                return calculateSeason(yesterday, receiving, leftBox, leftPan, leftPiece);
            } else {
                return calculateCheese(yesterday, receiving, leftBox, leftPan, leftPiece);
            }
        }

        let sanitize = input => {
            let value = parseInt(input);
            console.log("value = "  + value);
            return isNaN(value) ? 0 : value;
        }

        let calculateCheese = (yesterday, receiving, leftBox, leftPan, leftPiece) => {
            // 입고
            let r1 = receiving * 4;
            // 남은재고
            let r3 = (leftBox * 4) + leftPan + (leftPiece > 0 ? 0.5 : 0);
            // 당일생산
            let r2 = (yesterday + r1) - r3;


            return {
                receiving : r1,
                todaySell : r2,
                left : r3,
            };
        }

        let calculateSeason = (yesterday, receiving, leftBox, leftPan, leftPiece) => {
            // 입고
            let r1 = receiving * 4 * 36;
            // 남은재고
            let r3 = (leftBox * 4 * 36) + (leftPan * 36) + leftPiece;
            // 당일생산
            let r2 = (yesterday + r1) - r3;

            return {
                receiving : r1,
                todaySell : r2,
                left : r3,
            };
        }

    </script>
</body>
</html>